Ссылка на проект: https://github.com/zeneka441/web-larek-frontend

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

### Интерфейсы

#### ICard
Интерфейс карточки товара, описывающий основную информацию о продукте в каталоге.

```
export interface ICard {
  _id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

#### IForm
Интерфейс формы заказа, содержащий информацию о способе оплаты, адресе доставки и контактных данных покупателя.

```
export interface IForm {
  paymentType: 'online' | 'cash';
  address: string;
  email: string;
  phone: string;
  items: ICard[];
}
```

#### ICardsList
Интерфейс списка карточек товаров с возможностью просмотра карточки товара.

```
export interface ICardsList {
  cards: ICard[];
  preview: string | null;
}
```

### Типы

#### TProductThumbnail
Тип для отображения товара в виде миниатюры в каталоге. Содержит только необходимые поля для карточки товара.

```
export type TProductThumbnail = Pick<ICard, '_id' | 'category' | 'title' | 'image' | 'price'>;
```

#### TProductCart
Тип для отображения товара в корзине. Содержит минимальную информацию, необходимую для корзины покупок.

```
export type TProductCart = Pick<ICard, '_id' | 'title' | 'price'>;
```

#### TPayment
Тип для данных о способе оплаты и адресе доставки, используемый на первом этапе оформления заказа.

```
export type TPayment = Pick<IForm, 'paymentType' | 'address'>;
```

#### TContact
Тип для контактных данных покупателя, используемый на втором этапе оформления заказа.

```
export type TContact = Pick<IForm, 'email' | 'phone'>;
```

## Архитектура приложения


Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### 1. Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 

### 2. Слой данных


#### 2.1 Класс CardsList
Класс отвечает за хранение и отображение данных карточек товаров.\
Используется для взаимодействия с каталогом товаров на главной странице и для управления отображением карточки в модальном окне.
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив всех карточек товаров, загруженных с сервера;
- preview: string | null - карточка, выбранная для предварительного просмотра;
##### Методы:
- getCard(cardId: string) - возвращает карточку по её ID;
- showCard(cardId: ICard) - устанавливает карточку для предпросмотра по её ID;

#### 2.2 Класс FormData
Класс отвечает за хранение данных формы заказа, включая способ оплаты, адрес, а также контактную информацию пользователя.\
Используется на этапе оформления заказа.
В полях класса хранятся следующие данные:
- paymentType: 'online' | 'cash' — выбранный способ оплаты;
- address: string — адрес доставки;
- email: string — контактный email покупателя;
- phone: string — контактный номер телефона;
- events: EventEmitter — брокер событий, через который уведомляются другие компоненты о вводе и валидации данных.
##### Методы:
- setPaymentAndAddress(paymentType: 'online' | 'cash', address: string) - сохраняет данные первого шага оформления заказа (доставка и оплата);
- setContacts(data: Record<'email' | 'phone', string>) - сохраняет данные второго шага (контакты);
- clearData() - сбрасывает все сохранённые данные формы, например после успешной оплаты.

#### 2.3 Класс BasketModel
Класс управляет корзиной товаров.\
Поля:
- items: ICard[] - текущие товары в корзине;
- events: EventEmitter - брокер событий для обработки `card:add` и `cart:item-remove`.

##### Методы:
- add(cardId: string) - добавить товар;
- remove(cardId: string) - удалить товар;
- getItems() - получить содержимое;
- getTotal() - сумма заказа;
- clear() - очистить корзину.


### 2.4 Классы представления
Все классы представления отвечают за отображение контейнера (DOM-элемент) передаваемых в них данных.

#### 2.4.1 Класс CardView
Отвечает за отображение общей карточки товара.

##### Поля:
- element: HTMLElement - DOM-элемент карточки;
- render(card: TProductThumbnail) - получает данные карточки и использует их для отображения;
- events: EventEmitter - брокер событий.

##### Методы:
- render() - создаёт и возвращает DOM-элемент карточки;
- bindEvents() - вешает обработчики кликов на кнопку "Купить" и саму карточку.

#### 2.4.2 Класс Modal
Реализует модальное окно. Так же предоставляет методы `ореп` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\
• constructor (selector: string, events: lEvents) - Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

##### Поля:
- element: HTMLElement - корневой DOM-элемент модального окна;
- events: EventEmitter - брокер событий.

##### Методы:
- open(content: HTMLElement) - отображает модалку, принимая html элемент, который нужно отобразить;
- close() - закрывает модалку;
- setEventHandlers() - вешает обработчики для закрытия по esc, оверлей и кнопке.


#### 2.4.3 Класс CatalogView
Класс отвечает за отображение каталога товаров на главной странице.
##### Поля:
- container: HTMLElement - контейнер, в который рендерятся карточки;
- events: EventEmitter - брокер событий.

##### Методы:
- render(elements: HTMLElement[]) — принимает массив html-элементов карточек товаров и отображает их внутри контейнера;
- setHandlers(callback: (id: string) => void) - устанавливает обработчик кликов на карточки.


#### 2.4.4 Класс CartView
Отвечает за отображение содержимого корзины, включая список добавленных товаров и итоговую сумму.

##### Поля:
- container: HTMLElement - контейнер, в который рендерится корзина;
- events: EventEmitter - брокер событий.

##### Методы:
- render(elements: HTMLElement[], total: number) - принимает массив DOM-элементов товаров и итоговую сумму, отображает содержимое корзины;
- onCheckout(callback: () => void) - устанавливает обработчик кнопки "Оформить";
- onRemove(callback: (id: string) => void) - передаёт обработчик кнопок удаления.


#### 2.4.5 Класс FormStep1View / FormStep2View
Оба класса реализуют шаги формы оформления заказа:
- FormStep1View — выбор способа оплаты и адреса доставки.
- FormStep2View — ввод контактной информации (email и телефон).

##### Поля:
- container: HTMLElement - DOM-элемент формы;
- events: EventEmitter - брокер событий.

##### Методы:
- render() - отрисовывает поля и кнопку Далее;
- onComplete(callback: (data: TPayment) => void) - вызывает колбэк при валидной отправке;
- validate() - собирает введенные данные и передает их в модель для валидации.

#### 2.4.6 Класс ConfirmationView
Класс отображает финальный экран с подтверждением успешного оформления заказа.

##### Поля:
- container: HTMLElement - DOM-элемент, в который рендерится подтверждение.

##### Методы:
- render(total: number) - показывает сообщение об успешной покупке и итоговую сумму списания;
- clear() - сбрасывает форму.


### 3. Слой коммуникации
#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*
- `catalog:loaded` - загрузка каталога
- `card:add` - добавление товара в корзину
- `cart:remove` - удаление товара из корзины
- `form:step1-completed` - ввод адреса
- `form:step2-completed` - ввод контактов
- `order:success` - отправка формы






